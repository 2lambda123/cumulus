<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Share S3 Access Logs · Cumulus Documentation</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="# Sharing S3 Access Logs"/><meta name="docsearch:version" content="v14.0.0"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Share S3 Access Logs · Cumulus Documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="https://nasa.github.io/cumulus/"/><meta property="og:description" content="# Sharing S3 Access Logs"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/cumulus/undefined"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100,"backgroundColor":"#2276AC"}
          )
        });
        </script><script src="/cumulus/js/scrollSpy.js"></script><link rel="stylesheet" href="/cumulus/css/main.css"/><script src="/cumulus/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/cumulus/"><h2 class="headerTitle">Cumulus Documentation</h2></a><a href="/cumulus/versions"><h3>v14.0.0</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="https://nasa.github.io/cumulus-api" target="_self">API Docs</a></li><li class=""><a href="https://nasa.github.io/cumulus-distribution-api" target="_self">Distribution API Docs</a></li><li class=""><a href="/cumulus/docs/cumulus-docs-readme" target="_self">Developer Docs</a></li><li class=""><a href="/cumulus/docs/data-cookbooks/about-cookbooks" target="_self">Data-Cookbooks</a></li><li class=""><a href="/cumulus/docs/operator-docs/about-operator-docs" target="_self">Operator Docs</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"></header><article><div><span><h1><a class="anchor" aria-hidden="true" id="sharing-s3-access-logs"></a><a href="#sharing-s3-access-logs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sharing S3 Access Logs</h1>
<p>It is possible through Cumulus to share S3 access logs across multiple S3 packages using the S3 replicator package.</p>
<h2><a class="anchor" aria-hidden="true" id="s3-replicator"></a><a href="#s3-replicator" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>S3 Replicator</h2>
<p>The S3 Replicator is a node package that contains a simple lambda function, associated permissions, and the Terraform instructions to replicate create-object events from one S3 bucket to another.</p>
<p>First ensure that you have enabled <a href="../deployment/server_access_logging">S3 Server Access Logging</a>.</p>
<p>Next configure your <code>config.tfvars</code> as described in the <a href="https://github.com/nasa/cumulus/blob/master/tf-modules/s3-replicator/README.md"><code>s3-replicator/README.md</code></a> to correspond to your deployment.  The <code>source_bucket</code> and <code>source_prefix</code> are determined by how you enabled the <a href="../deployment/server_access_logging">S3 Server Access Logging</a>.</p>
<p>In order to deploy the s3-replicator with cumulus you will need to add the module to your terraform main.tf definition.
e.g.</p>
<pre><code class="hljs css language-hcl">module <span class="hljs-string">"s3-replicator"</span> {
  source = <span class="hljs-string">"&lt;path to s3-replicator.zip&gt;"</span>
  prefix               = <span class="hljs-selector-tag">var</span><span class="hljs-selector-class">.prefix</span>
  vpc_id               = <span class="hljs-selector-tag">var</span><span class="hljs-selector-class">.vpc_id</span>
  subnet_ids           = <span class="hljs-selector-tag">var</span><span class="hljs-selector-class">.subnet_ids</span>
  permissions_boundary = <span class="hljs-selector-tag">var</span><span class="hljs-selector-class">.permissions_boundary_arn</span>
  source_bucket        = <span class="hljs-selector-tag">var</span><span class="hljs-selector-class">.s3_replicator_config</span><span class="hljs-selector-class">.source_bucket</span>
  source_prefix        = <span class="hljs-selector-tag">var</span><span class="hljs-selector-class">.s3_replicator_config</span><span class="hljs-selector-class">.source_prefix</span>
  target_bucket        = <span class="hljs-selector-tag">var</span><span class="hljs-selector-class">.s3_replicator_config</span><span class="hljs-selector-class">.target_bucket</span>
  target_prefix        = <span class="hljs-selector-tag">var</span><span class="hljs-selector-class">.s3_replicator_config</span><span class="hljs-selector-class">.target_prefix</span>
}
</code></pre>
<p>The terraform source package can be found on the <a href="https://github.com/nasa/cumulus/releases">Cumulus github release page</a> under the asset tab <code>terraform-aws-cumulus-s3-replicator.zip</code>.</p>
<h2><a class="anchor" aria-hidden="true" id="esdis-metrics"></a><a href="#esdis-metrics" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ESDIS Metrics</h2>
<p>In the NGAP environment, the ESDIS Metrics team has set up an ELK stack to process logs from Cumulus instances.  To use this system, you must deliver any S3 Server Access logs that Cumulus creates.</p>
<p>Configure the S3 replicator as described above using the <code>target_bucket</code> and <code>target_prefix</code> provided by the metrics team.</p>
<p>The metrics team has taken care of setting up Logstash to ingest the files that get delivered to their bucket into their Elasticsearch instance.</p>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#s3-replicator">S3 Replicator</a></li><li><a href="#esdis-metrics">ESDIS Metrics</a></li></ul></nav></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'f7e0be879553661f9043322d119069c8',
                indexName: 'nasa_cumulus',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["version:v14.0.0"]}
              });
            </script></body></html>