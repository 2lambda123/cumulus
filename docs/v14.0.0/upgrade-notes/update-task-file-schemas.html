<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Updates to task granule file schemas · Cumulus Documentation</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## Background"/><meta name="docsearch:version" content="v14.0.0"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Updates to task granule file schemas · Cumulus Documentation"/><meta property="og:type" content="website"/><meta property="og:url" content="https://nasa.github.io/cumulus/"/><meta property="og:description" content="## Background"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/cumulus/undefined"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100,"backgroundColor":"#2276AC"}
          )
        });
        </script><script src="/cumulus/js/scrollSpy.js"></script><link rel="stylesheet" href="/cumulus/css/main.css"/><script src="/cumulus/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/cumulus/"><h2 class="headerTitle">Cumulus Documentation</h2></a><a href="/cumulus/versions"><h3>v14.0.0</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="https://nasa.github.io/cumulus-api" target="_self">API Docs</a></li><li class=""><a href="https://nasa.github.io/cumulus-distribution-api" target="_self">Distribution API Docs</a></li><li class="siteNavGroupActive"><a href="/cumulus/docs/v14.0.0/cumulus-docs-readme" target="_self">Developer Docs</a></li><li class=""><a href="/cumulus/docs/v14.0.0/data-cookbooks/about-cookbooks" target="_self">Data-Cookbooks</a></li><li class=""><a href="/cumulus/docs/v14.0.0/operator-docs/about-operator-docs" target="_self">Operator Docs</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Upgrade Notes</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Getting Started<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/cumulus-docs-readme">Introduction</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/getting-started">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/glossary">Glossary</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/faqs">Frequently Asked Questions</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">About Cumulus<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/architecture">Architecture</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/interfaces">Interfaces</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/team">Cumulus Team</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Overviews<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/workflows/workflows-readme">Workflows</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/workflows/protocol">Workflow Protocol</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/workflows/input_output">Workflow Inputs &amp; Outputs</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/workflows/cumulus-task-message-flow">Cumulus Tasks: Message Flow</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/workflows/workflow-triggers">Workflow Triggers</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Deployment<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/deployment/deployment-readme">How to Deploy Cumulus</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/deployment/create_bucket">Creating an S3 Bucket</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/deployment/terraform-best-practices">Terraform Best Practices</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/deployment/choosing_configuring_rds">Choosing and configuration your RDS database</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/deployment/postgres_database_deployment">PostgreSQL Database Deployment</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/deployment/components">Component-based Cumulus Deployment</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/deployment/thin_egress_app">Using the Thin Egress App for Cumulus distribution</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/deployment/cumulus_distribution">Using the Cumulus Distribution API</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/deployment/api-gateway-logging">API Gateway Logging</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/deployment/share-s3-access-logs">Share S3 Access Logs</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/deployment/cloudwatch-logs-delivery">Configure Cloudwatch Logs Delivery</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/deployment/upgrade-readme">Upgrading Cumulus</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Configuration<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/configuration/monitoring-readme">Monitoring Best Practices</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/configuration/server_access_logging">S3 Server Access Logging</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/configuration/cloudwatch-retention">Cloudwatch Retention</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/configuration/lifecycle-policies">Setting S3 Lifecycle Policies</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/configuration/collection-storage-best-practices">Collection Cost Tracking and Storage Best Practices</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/configuration/task-configuration">Configuration of Tasks</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Development<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/workflows/developing-a-cumulus-workflow">Creating a Cumulus Workflow</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/workflows/developing-workflow-tasks">Developing Workflow Tasks</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/workflows/lambda">Develop Lambda Functions</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/workflows/docker">Dockerizing Data Processing</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/workflows/workflow-configuration-how-to">Workflow Configuration How To&#x27;s</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Workflow Tasks<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/tasks">Cumulus Tasks</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/workflow_tasks/discover_granules">Discover Granules</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/workflow_tasks/files_to_granules">Files To Granules</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/workflow_tasks/lzards_backup">LZARDS Backup</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/workflow_tasks/move_granules">Move Granules</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/workflow_tasks/parse_pdr">Parse PDR</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/workflow_tasks/queue_granules">Queue Granules</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Features<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/features/backup_and_restore">Cumulus Backup and Restore</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/features/dead_letter_queues">Dead Letter Queues</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/features/ems_reporting">EMS Reporting</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/features/execution_payload_retention">Execution Payload Retention</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/features/reports">Reconciliation Reports</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/features/lambda_versioning">Lambda Versioning</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/features/ancillary_metadata">Ancillary Metadata Export</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/features/distribution-metrics">Cumulus Distribution Metrics</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/features/logging-esdis-metrics">Writing logs for ESDIS Metrics</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Troubleshooting<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/troubleshooting/troubleshooting-readme">How to Troubleshoot and Fix Issues</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/troubleshooting/troubleshooting-deployment">Troubleshooting Deployment</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/troubleshooting/reindex-elasticsearch">Reindexing Elasticsearch Guide</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Cumulus Development<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/adding-a-task">Contributing a Task</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/docs-how-to">Cumulus Documentation: How To&#x27;s</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Integrator Guide<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/integrator-guide/about-int-guide">About Integrator Guide</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/integrator-guide/int-common-use-cases">Integrator Common Use Cases</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/integrator-guide/workflow-add-new-lambda">Workflow - Add New Lambda</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/integrator-guide/workflow-ts-failed-step">Workflow - Troubleshoot Failed Step(s)</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Upgrade Notes<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/upgrade-notes/migrate_tea_standalone">Migrate TEA deployment to standalone module</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/upgrade-notes/upgrade_tf_version_0.13.6">Upgrade to TF version 0.13.6</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/upgrade-notes/upgrade-rds">Upgrade to RDS release</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/upgrade-notes/cumulus_distribution_migration">Migrate from TEA deployment to Cumulus Distribution</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/cumulus/docs/v14.0.0/upgrade-notes/update-task-file-schemas">Updates to task granule file schemas</a></li><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/upgrade-notes/update-cma-2.0.2">Upgrade to CMA 2.0.2</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">External Contributions<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/cumulus/docs/v14.0.0/external-contributions/external-contributions">External Contributions</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Updates to task granule file schemas</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="background"></a><a href="#background" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Background</h2>
<p>Most Cumulus workflow tasks expect as input a payload of granule(s) which contain the files for each granule. Most tasks also return this same granule structure as output.</p>
<p>However, up to this point, there was inconsistency in the schemas for the granule <code>files</code> objects expected by each task. Furthermore, there was no guarantee of consistency between granule <code>files</code> objects as stored in the database and the expectations of any given workflow task.</p>
<p>Thus, when performing bulk granule operations which pass granules from the database into a Cumulus workflow, it was possible for there to be schema validation failures depending on which task was used to start the workflow and its particular schema.</p>
<p>In order to rectify this situation, <a href="https://bugs.earthdata.nasa.gov/browse/CUMULUS-2388">CUMULUS-2388</a> was filed and addressed to create a common granule files schema between nearly all of the Cumulus tasks (exceptions discussed below) and the Cumulus database. The following documentation explains the manual changes you need to make to your deployment in order to be compatible with the updated files schema.</p>
<h2><a class="anchor" aria-hidden="true" id="updated-files-schema"></a><a href="#updated-files-schema" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Updated files schema</h2>
<p>The updated granule files schema <a href="https://github.com/nasa/cumulus/blob/master/packages/schemas/files.schema.json">can be found here</a>.</p>
<p>These former properties were deprecated (with notes about how to derive the same information from the updated schema, if possible):</p>
<ul>
<li><code>filename</code> - concatenate the <code>bucket</code> and <code>key</code> values with a directory separator (<code>/</code>)</li>
<li><code>name</code> - use <code>fileName</code> property</li>
<li><code>etag</code> - ETags are no longer provided as an individual file property. Instead, a separate <code>etags</code> object mapping S3 URIs to ETag values is provided as output from the following workflow tasks (guidance on how to integrate this output with your workflows is provided in the <a href="#upgrading-your-workflows">Upgrading your workflows</a> section below):
<ul>
<li><code>update-granules-cmr-metadata-file-links</code></li>
<li><code>hyrax-metadata-updates</code></li>
</ul></li>
<li><code>fileStagingDir</code> - no longer supported</li>
<li><code>url_path</code> - no longer supported</li>
<li><code>duplicate_found</code> - This property is no longer supported, however <code>sync-granule</code> and <code>move-granules</code> now produce a separate <code>granuleDuplicates</code> object as part of their output. The <code>granuleDuplicates</code> object is a map of granules by granule ID which includes the files that encountered duplicates during processing. <a href="#optional---integrate-granuleduplicates-information">Guidance on how to integrate <code>granuleDuplicates</code> information into your workflow configuration is provided below</a>.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="exceptions"></a><a href="#exceptions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Exceptions</h2>
<p>These workflow tasks did not have their schema for granule files updated:</p>
<ul>
<li><code>discover-granules</code> - no updates</li>
<li><code>queue-granules</code> - no updates</li>
<li><code>parse-pdr</code> - no updates</li>
<li><code>sync-granule</code> - input schema not updated, output schema was updated</li>
</ul>
<p>The reason that these task schemas were not updated is that all of these tasks start before the files have been ingested to S3, thus much of the information that is required in the updated files schema like <code>bucket</code>, <code>key</code>, or <code>checksum</code> is not yet known.</p>
<h3><a class="anchor" aria-hidden="true" id="bulk-granule-operations"></a><a href="#bulk-granule-operations" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bulk granule operations</h3>
<p>Since the input schema for the above tasks was not updated, that means you cannot run bulk granule operations against workflows <strong>if they start with any of those tasks</strong>. Bulk granule operations work by loading the specified granules from the database and sending them as input to a specified workflow, so if the specified workflow begins with a task whose input schema does not conform to what is coming out of the database, there will be schema errors.</p>
<h2><a class="anchor" aria-hidden="true" id="upgrading-your-deployment"></a><a href="#upgrading-your-deployment" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Upgrading your deployment</h2>
<h3><a class="anchor" aria-hidden="true" id="upgrading-your-workflows"></a><a href="#upgrading-your-workflows" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Upgrading your workflows</h3>
<h3><a class="anchor" aria-hidden="true" id="update-granules-cmr-metadata-file-links"></a><a href="#update-granules-cmr-metadata-file-links" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>update-granules-cmr-metadata-file-links</code></h3>
<p>For any workflows using the <code>update-granules-cmr-metadata-file-links</code> task before the <code>hyrax-metadata-updates</code> and/or <code>post-to-cmr</code> tasks, update the step definition for <code>update-granules-cmr-metadata-file-links</code> as follows:</p>
<pre><code class="hljs css language-hcl">    <span class="hljs-string">"UpdateGranulesCmrMetadataFileLinksStep"</span>: {
      <span class="hljs-string">"Parameters"</span>: {
        <span class="hljs-string">"cma"</span>: {
          <span class="hljs-string">"event.<span class="hljs-variable">$</span>"</span>: <span class="hljs-string">"<span class="hljs-variable">$</span>"</span>,
          <span class="hljs-string">"task_config"</span>: {
            <span class="hljs-string">"buckets"</span>: <span class="hljs-string">"{<span class="hljs-variable">$</span>.meta.buckets}"</span>,
            <span class="hljs-string">"distribution_endpoint"</span>: <span class="hljs-string">"{<span class="hljs-variable">$</span>.meta.distribution_endpoint}"</span>,
            <span class="hljs-string">"cumulus_message"</span>: {
              <span class="hljs-string">"outputs"</span>: [
                {
                  <span class="hljs-string">"source"</span>: <span class="hljs-string">"{<span class="hljs-variable">$</span>.etags}"</span>,
                  <span class="hljs-string">"destination"</span>: <span class="hljs-string">"{<span class="hljs-variable">$</span>.meta.file_etags}"</span>
                },
                {
                  <span class="hljs-string">"source"</span>: <span class="hljs-string">"{<span class="hljs-variable">$</span>}"</span>,
                  <span class="hljs-string">"destination"</span>: <span class="hljs-string">"{<span class="hljs-variable">$</span>.payload}"</span>
                }
              ]
            }
          }
        }
      },
      ...more configuration...
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="hyrax-metadata-updates"></a><a href="#hyrax-metadata-updates" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>hyrax-metadata-updates</code></h4>
<p>For any workflows using the <code>hyrax-metadata-updates</code> task before a <code>post-to-cmr</code> task, update the definition of the <code>hyrax-metadata-updates</code> step as follows:</p>
<pre><code class="hljs css language-hcl">    <span class="hljs-string">"HyraxMetadataUpdatesTask"</span>: {
      <span class="hljs-string">"Parameters"</span>: {
        <span class="hljs-string">"cma"</span>: {
          <span class="hljs-string">"event.<span class="hljs-variable">$</span>"</span>: <span class="hljs-string">"<span class="hljs-variable">$</span>"</span>,
          <span class="hljs-string">"ReplaceConfig"</span>: {
            <span class="hljs-string">"FullMessage"</span>: true
          },
          <span class="hljs-string">"task_config"</span>: {
            <span class="hljs-string">"bucket"</span>: <span class="hljs-string">"{<span class="hljs-variable">$</span>.meta.buckets.internal.name}"</span>,
            <span class="hljs-string">"stack"</span>: <span class="hljs-string">"{<span class="hljs-variable">$</span>.meta.stack}"</span>,
            <span class="hljs-string">"cmr"</span>: <span class="hljs-string">"{<span class="hljs-variable">$</span>.meta.cmr}"</span>,
            <span class="hljs-string">"launchpad"</span>: <span class="hljs-string">"{<span class="hljs-variable">$</span>.meta.launchpad}"</span>,
            <span class="hljs-string">"etags"</span>: <span class="hljs-string">"{<span class="hljs-variable">$</span>.meta.file_etags}"</span>,
            <span class="hljs-string">"cumulus_message"</span>: {
              <span class="hljs-string">"outputs"</span>: [
                {
                  <span class="hljs-string">"source"</span>: <span class="hljs-string">"{<span class="hljs-variable">$</span>.etags}"</span>,
                  <span class="hljs-string">"destination"</span>: <span class="hljs-string">"{<span class="hljs-variable">$</span>.meta.file_etags}"</span>
                },
                {
                  <span class="hljs-string">"source"</span>: <span class="hljs-string">"{<span class="hljs-variable">$</span>}"</span>,
                  <span class="hljs-string">"destination"</span>: <span class="hljs-string">"{<span class="hljs-variable">$</span>.payload}"</span>
                }
              ]
            }
          }
        }
      },
      ...more configuration...
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="post-to-cmr"></a><a href="#post-to-cmr" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>post-to-cmr</code></h4>
<p>For any workflows using <code>post-to-cmr</code> task after the <code>update-granules-cmr-metadata-file-links</code> or <code>hyrax-metadata-updates</code> tasks, update the <code>post-to-cmr</code> step definition as follows:</p>
<pre><code class="hljs css language-hcl">    <span class="hljs-string">"CmrStep"</span>: {
      <span class="hljs-string">"Parameters"</span>: {
        <span class="hljs-string">"cma"</span>: {
          <span class="hljs-string">"event.<span class="hljs-variable">$</span>"</span>: <span class="hljs-string">"<span class="hljs-variable">$</span>"</span>,
          <span class="hljs-string">"ReplaceConfig"</span>: {
            <span class="hljs-string">"FullMessage"</span>: true
          },
          <span class="hljs-string">"task_config"</span>: {
            <span class="hljs-string">"bucket"</span>: <span class="hljs-string">"{<span class="hljs-variable">$</span>.meta.buckets.internal.name}"</span>,
            <span class="hljs-string">"stack"</span>: <span class="hljs-string">"{<span class="hljs-variable">$</span>.meta.stack}"</span>,
            <span class="hljs-string">"cmr"</span>: <span class="hljs-string">"{<span class="hljs-variable">$</span>.meta.cmr}"</span>,
            <span class="hljs-string">"launchpad"</span>: <span class="hljs-string">"{<span class="hljs-variable">$</span>.meta.launchpad}"</span>,
            <span class="hljs-string">"etags"</span>: <span class="hljs-string">"{<span class="hljs-variable">$</span>.meta.file_etags}"</span>
          }
        }
      },
      ...more configuration...
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="example-workflow"></a><a href="#example-workflow" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example workflow</h4>
<p>For an example workflow integrating all of these changes, please see our example <a href="https://github.com/nasa/cumulus/blob/master/example/cumulus-tf/ingest_and_publish_granule_workflow.asl.json">ingest and publish workflow</a>.</p>
<h4><a class="anchor" aria-hidden="true" id="optional---integrate-granuleduplicates-information"></a><a href="#optional---integrate-granuleduplicates-information" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Optional - Integrate granuleDuplicates information</h4>
<p><strong>Please note</strong> that the <code>granuleDuplicates</code> output is purely <strong>informational</strong> and does not have any bearing on the separate configuration for how duplicates should be handled.</p>
<p>You can include <code>granuleDuplicates</code> output from the <code>sync-granule</code> or <code>move-granules</code> tasks in your workflow messages like so:</p>
<pre><code class="hljs css language-hcl">    <span class="hljs-string">"SyncGranule"</span>: {
      <span class="hljs-string">"Parameters"</span>: {
        <span class="hljs-string">"cma"</span>: {
          <span class="hljs-string">"event.<span class="hljs-variable">$</span>"</span>: <span class="hljs-string">"<span class="hljs-variable">$</span>"</span>,
          <span class="hljs-string">"task_config"</span>: {
            ...other config...
            <span class="hljs-string">"cumulus_message"</span>: {
              <span class="hljs-string">"outputs"</span>: [
                {
                  <span class="hljs-string">"source"</span>: <span class="hljs-string">"{<span class="hljs-variable">$</span>.granuleDuplicates}"</span>,
                  <span class="hljs-string">"destination"</span>: <span class="hljs-string">"{<span class="hljs-variable">$</span>.meta.sync_granule.granule_duplicates}"</span>
                },
                {
                  <span class="hljs-string">"source"</span>: <span class="hljs-string">"{<span class="hljs-variable">$</span>}"</span>,
                  <span class="hljs-string">"destination"</span>: <span class="hljs-string">"{<span class="hljs-variable">$</span>.payload}"</span>
                }
              ]
            }
          }
        }
      }
      ...more configuration...
</code></pre>
<p>The result of this configuration is that the <code>granuleDuplicates</code> output from <code>sync-granule</code> would be placed in <code>meta.sync_granule.granule_duplicates</code> on the workflow message and remain there throughout the rest of the workflow. The same configuration could be replicated for the <code>move-granules</code> task, but be sure to use a different <code>destination</code> in the workflow message for the <code>granuleDuplicates</code> output .</p>
<h3><a class="anchor" aria-hidden="true" id="updating-collection-url-path-templates"></a><a href="#updating-collection-url-path-templates" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Updating collection URL path templates</h3>
<p><a href="../workflows/workflow-configuration-how-to#using-a-template-for-file-placement">Collections can specify <code>url_path</code> templates to dynamically generate the final location of files</a>. As part of <code>url_path</code> templates, file object properties can be interpolated to generate the file path. Thus, these <code>url_path</code> templates need to be updated to ensure that they are compatible with the updated files schema and the properties that will actually be available on file objects.</p>
<p>See the notes on the <a href="#updated-files-schema">updated files schema</a> to know which properties are available and which previously existing properties were deprecated.</p>
<p>As an example, you will want to update any <code>url_path</code> properties in your collections to remove references to <code>file.name</code> and replace them with references to <code>file.fileName</code> like so:</p>
<pre><code class="hljs css language-diff"><span class="hljs-deletion">- "url_path": "{cmrMetadata.CollectionReference.ShortName}___{cmrMetadata.CollectionReference.Version}/{substring(file.name, 0, 3)}",</span>
<span class="hljs-addition">+ "url_path": "{cmrMetadata.CollectionReference.ShortName}___{cmrMetadata.CollectionReference.Version}/{substring(file.fileName, 0, 3)}",</span>
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/cumulus/docs/v14.0.0/upgrade-notes/cumulus_distribution_migration"><span class="arrow-prev">← </span><span>Migrate from TEA deployment to Cumulus Distribution</span></a><a class="docs-next button" href="/cumulus/docs/v14.0.0/upgrade-notes/update-cma-2.0.2"><span>Upgrade to CMA 2.0.2</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#background">Background</a></li><li><a href="#updated-files-schema">Updated files schema</a></li><li><a href="#exceptions">Exceptions</a><ul class="toc-headings"><li><a href="#bulk-granule-operations">Bulk granule operations</a></li></ul></li><li><a href="#upgrading-your-deployment">Upgrading your deployment</a><ul class="toc-headings"><li><a href="#upgrading-your-workflows">Upgrading your workflows</a></li><li><a href="#update-granules-cmr-metadata-file-links"><code>update-granules-cmr-metadata-file-links</code></a></li><li><a href="#updating-collection-url-path-templates">Updating collection URL path templates</a></li></ul></li></ul></nav></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '1a3df8fed03e0ad718e663c44a94fe41',
                indexName: 'nasa_cumulus',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["version:v14.0.0"]}
              });
            </script></body></html>