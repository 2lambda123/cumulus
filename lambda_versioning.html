
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Lambda Versioning Â· Cumulus Documentation</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="styles/website.css">
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="ems_reporting.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Documentation</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Home
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="architecture.html">
            
                <a href="architecture.html">
            
                    
                    Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="workflows/">
            
                <a href="workflows/">
            
                    
                    What are Cumulus Workflows?
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="workflows/protocol.html">
            
                <a href="workflows/protocol.html">
            
                    
                    Workflow Protocol
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="tasks.html">
            
                <a href="tasks.html">
            
                    
                    Workflow Tasks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="workflows/input_output.html">
            
                <a href="workflows/input_output.html">
            
                    
                    Workflow Input & Ouptut
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="workflows/cumulus-task-message-flow.html">
            
                <a href="workflows/cumulus-task-message-flow.html">
            
                    
                    Workflow Task Message Flow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="workflows/developing-workflow-tasks.html">
            
                <a href="workflows/developing-workflow-tasks.html">
            
                    
                    Developing Workflow Tasks
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.5.1" data-path="workflows/lambda.html">
            
                <a href="workflows/lambda.html">
            
                    
                    Lambda Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5.2" data-path="workflows/docker.html">
            
                <a href="workflows/docker.html">
            
                    
                    Dockerization
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="workflows/workflow-configuration-how-to.html">
            
                <a href="workflows/workflow-configuration-how-to.html">
            
                    
                    Workflow Configuration How-to's
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="workflows/workflow-triggers.html">
            
                <a href="workflows/workflow-triggers.html">
            
                    
                    Workflow Triggers
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Deployment
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="deployment/">
            
                <a href="deployment/">
            
                    
                    How to Deploy Cumulus
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="deployment/create_bucket.html">
            
                <a href="deployment/create_bucket.html">
            
                    
                    Creating an S3 Bucket
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="deployment/iam_roles.html">
            
                <a href="deployment/iam_roles.html">
            
                    
                    Locating IAMs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="deployment/troubleshoot_deployment.html">
            
                <a href="deployment/troubleshoot_deployment.html">
            
                    
                    Troubleshooting Deployment
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <a target="_blank" href="https://nasa.github.io/cumulus-api">
            
                    
                    Cumulus API Docs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    Additional Cumulus Features
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="data_in_dynamodb.html">
            
                <a href="data_in_dynamodb.html#cumulus-metadata-in-dynamodb">
            
                    
                    Cumulus Metadata in DynamoDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="data_in_dynamodb.html">
            
                <a href="data_in_dynamodb.html#backup-and-restore-with-aws">
            
                    
                    DynamoDB Backup and Restore
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="data_in_dynamodb.html">
            
                <a href="data_in_dynamodb.html#dynamodb-auto-scaling">
            
                    
                    DynamoDB Auto Scaling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="ems_reporting.html">
            
                <a href="ems_reporting.html">
            
                    
                    EMS Reporting
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.6.5" data-path="lambda_versioning.html">
            
                <a href="lambda_versioning.html">
            
                    
                    Lambda Versioning
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <a target="_blank" href="https://github.com/nasa/cumulus/blob/master/CHANGELOG.md">
            
                    
                    Changelog
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="upgrade/">
            
                <a href="upgrade/">
            
                    
                    Upgrade Instructions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="upgrade/1.6.0.html">
            
                <a href="upgrade/1.6.0.html">
            
                    
                    1.6.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="upgrade/1.7.0.html">
            
                <a href="upgrade/1.7.0.html">
            
                    
                    1.7.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="upgrade/1.9.0.html">
            
                <a href="upgrade/1.9.0.html">
            
                    
                    1.9.0
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="system-documentation/system-documentation.html">
            
                <a href="system-documentation/system-documentation.html">
            
                    
                    Operating and Troubleshooting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="doc_installation.html">
            
                <a href="doc_installation.html">
            
                    
                    Contributing to documentation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="adding-a-task.html">
            
                <a href="adding-a-task.html">
            
                    
                    Contributing a task
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="team.html">
            
                <a href="team.html">
            
                    
                    Team
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Data Cookbook</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="data-cookbooks/about-cookbooks.html">
            
                <a href="data-cookbooks/about-cookbooks.html">
            
                    
                    About Cookbooks
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="data-cookbooks/setup.html">
            
                <a href="data-cookbooks/setup.html">
            
                    
                    Collections, Providers, Schemas, and Rules
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="data-cookbooks/hello-world.html">
            
                <a href="data-cookbooks/hello-world.html">
            
                    
                    HelloWorldWorkflow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="data-cookbooks/sns.html">
            
                <a href="data-cookbooks/sns.html">
            
                    
                    SNS Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="data-cookbooks/sips-workflow.html">
            
                <a href="data-cookbooks/sips-workflow.html">
            
                    
                    SIPS Workflow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="data-cookbooks/cnm-workflow.html">
            
                <a href="data-cookbooks/cnm-workflow.html">
            
                    
                    CNM Workflow
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="data-cookbooks/error-handling.html">
            
                <a href="data-cookbooks/error-handling.html">
            
                    
                    Error Handling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="data-cookbooks/choice-states.html">
            
                <a href="data-cookbooks/choice-states.html">
            
                    
                    Choice States
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Lambda Versioning</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="lambda-versioning">Lambda Versioning</h1>
<p>Cumulus makes use of AWS&apos;s Lambda/Alias version objects to tag and retain references to recent copies of deployed workflow lambdas.</p>
<p>All Cumulus deployed lambdas in lambdas.yml will have an alias/version resource created. Lambdas with source coming from S3 must be expressly configured to take advantage of versioning.</p>
<p>A reference to the most current lambda version alias will replace the unversioned lambda resource ARN in all workflows for each task that is either built via Cumulus, or defined via the uniqueIdentifier configuration key for s3 sourced lambdas.</p>
<p>A configurable number of previously deployed alias/version pairs will be retained to ensure that in-progress workflows are able to complete.</p>
<p>This allows for workflows to automatically reference the specific version of a lambda function they were deployed with, prevents an updated deployment of an existing lambda from being utilized in an already in-progress workflow, and retains the executed version information in the AWS step function execution record and CloudWatch logs.</p>
<p><strong>Please note</strong> that care must be exercised to not update lambda versions and redeploy frequently enough that an in-progress workflow refers to an aged-off version of a lambda, or workflows that reference such a lambda may fail.</p>
<p>( See <a href="https://docs.aws.amazon.com/lambda/latest/dg/versioning-aliases.html" target="_blank">AWS Lambda Function Versioning and Aliases</a> for more on lambda versions/aliases)</p>
<h2 id="configuration">Configuration</h2>
<p>This feature is enabled by default for all Cumulus built/deployed lambdas, as well as s3Source lambdas that are configured as described below.  s3Source Lambdas that are not configured will continue to utilize an unqualified reference and will not utilize lambda versioning.</p>
<h3 id="s3source-lambda-version-configuration">s3Source Lambda Version Configuration</h3>
<p>Lambdas with s3Source defined currently require additional configuration to make use of this feature in the form of a &apos;uniqueIdentifier&apos; key:</p>
<pre><code>SomeLambda:
  Handler: lambda_handler.handler
  timeout: 300
  s3Source:
    bucket: &apos;{{some_bucket}}&apos;
    key: path/some-lambda.zip
    uniqueIdentifier: &apos;5dot2&apos;
  runtime: python2.7
</code></pre><p>That key, due to AWS constraints, must be letters (<code>[a-zA-Z]</code>) only.</p>
<h3 id="changing-number-of-retained-lambdas">Changing Number of Retained Lambdas</h3>
<p>The default number of retained lambda versions is 1.</p>
<p>This can be overridden by adding the following key to your configuration file:</p>
<p><code>maxNumberOfRetainedLambdas: X</code></p>
<p>where X is the number of previous versions you wish to retain.</p>
<p>This feature allows a variable number of retained lambdas, however due to CloudFormation limits and current implementation constraints, that number is fairly limited.</p>
<p>The <code>WorkflowLambdaVersions</code> sub-template is constrained to 200 total resources, in addition to only being able to output 60 aliases back to the master template.   As such, the limit on the template is:</p>
<p><code>(200/2+2*RV)-2</code> where RV = total number of retained versions.</p>
<p>Given the available limits, the following are the pratical limits on the number of lambdas that can be configured for a given number of retained lambdas:</p>
<ul>
<li><p>1: 48</p>
</li>
<li><p>2: 31</p>
</li>
<li><p>3: 23</p>
</li>
</ul>
<h3 id="disabling-lambda-versioning">Disabling Lambda Versioning</h3>
<p>This feature is enabled by default in the deployment package template, but can be disabled by adding the following key to your app/config.yml:</p>
<pre><code>useWorkflowLambdaVersions: false
</code></pre><p>Disabling this feature will result in Cumulus not creating alias/version lambda resource objects, the <code>WorkflowLambdaVersions</code> stack will not be created and the deployed workflow lambda references will be unqualified (always referring to the latest version).</p>
<p>Disabling this feature after deploying a stack with it enabled will remove the <code>WorkflowLambdaVersions</code> stack, remove all Cumulus defined lambda Version/Alias pairs and reset all workflows to using an unqualified lambda reference.     Workflows in progress with incomplete steps that have references to versioned lambdas will fail.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="ems_reporting.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: EMS Reporting">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Lambda Versioning","level":"1.6.5","depth":2,"next":{"title":"Changelog","level":"1.7","depth":1,"url":"https://github.com/nasa/cumulus/blob/master/CHANGELOG.md","ref":"https://github.com/nasa/cumulus/blob/master/CHANGELOG.md","articles":[]},"previous":{"title":"EMS Reporting","level":"1.6.4","depth":2,"path":"ems_reporting.md","ref":"ems_reporting.md","articles":[]},"dir":"ltr"},"config":{"plugins":[],"root":"docs","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"Cumulus Documentation","gitbook":"*"},"file":{"path":"lambda_versioning.md","mtime":"2018-10-24T21:57:57.465Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-10-24T21:59:10.434Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

